{"version":3,"sources":["../src/controller.js"],"names":["MetricsPanelCtrl","_","kbn","rendering","Controller","$scope","$injector","$rootScope","optionDefaults","type","legend","show","values","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","aliasColors","format","valueName","strokeWidth","fontSize","thresholds","unitSingle","unitPlural","esMetric","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","dataList","data","name","value","dname","nation","rows","forEach","push","render","addEditorTab","unitFormats","getUnitFormats","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","sourcesContent":["/* jshint esversion: 6 */\r\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport rendering from './rendering';\r\n\r\nexport class Controller extends MetricsPanelCtrl {\r\n  constructor($scope, $injector, $rootScope) {\r\n    super($scope, $injector);\r\n    this.$rootScope = $rootScope;\r\n    const optionDefaults = {\r\n      type: 'map',\r\n      legend: {\r\n        show: true,\r\n        values: true\r\n      },\r\n      links: [],\r\n      datasource: null,\r\n      maxDataPoints: 3,\r\n      interval: null,\r\n      targets: [{}],\r\n      cacheTimeout: null,\r\n      nullPointMode: 'connected',\r\n      legendType: 'Under graph',\r\n      aliasColors: {},\r\n      format: 'short',\r\n      valueName: 'current',\r\n      strokeWidth: 1,\r\n      fontSize: '80%',\r\n      thresholds: '0,200',\r\n      unitSingle: '',\r\n      unitPlural: '',\r\n      esMetric: 'Count',\r\n    };\r\n\r\n    _.defaults(this.panel, optionDefaults);\r\n    _.defaults(this.panel.legend, optionDefaults.legend);\r\n\r\n    this.events.on('render', this.onRender.bind(this));\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n  }\r\n\r\n  onRender() {\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    const [data] = dataList;\r\n    this.name = [];\r\n    this.value = [];\r\n    this.dname = [];\r\n    this.nation = [];\r\n    if (data) {\r\n      data.rows.forEach(([name, value,dname,nation]) => {\r\n        this.name.push(name);\r\n        this.value.push(value);\r\n        this.dname.push(dname);\r\n        this.nation.push(nation)\r\n      });\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  onDataError() {\r\n    this.render();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('图表选项', 'public/plugins/echarts-grafana/partials/module.editor.html', 2);\r\n    this.unitFormats = kbn.getUnitFormats();\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    rendering(scope, elem, attrs, ctrl);\r\n  }\r\n\r\n}\r\n\r\nController.templateUrl = './partials/module.html';\r\n"],"file":"controller.js"}